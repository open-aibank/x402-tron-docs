# 客户端与服务器
深入理解这些角色，对于在 TRON 区块链上设计、构建或集成基于 x402-tron 的程序化支付服务至关重要。

> **注意**
>
> * **客户端 (Client)**：指发起 HTTP 请求的技术组件。在实际业务场景中，通常对应资源的**买方**。
> * **服务端 (Server)**：指响应请求的技术组件。在实际业务场景中，通常对应资源的**卖方**。

## 客户端角色 (Client Role)

客户端是发起请求以访问付费资源的实体。

客户端的形式多种多样，包括：

- 面向用户的应用程序
- 自主代理 (Autonomous Agents)
- 代表用户或系统执行操作的后台服务

### 核心职责

- **发起请求**：向资源服务器发送初始 HTTP 请求。
- **处理支付要求**：解析 `402 Payment Required` 响应，并提取支付详情。
- **管理代币授权**：授权 PaymentPermit 合约从客户端钱包转移代币以完成支付结算。
- **准备支付载荷**：根据服务端的要求，构建并签署 TIP-712 支付载荷。
- **携带支付重试**：在请求头中附加 `PAYMENT-SIGNATURE` 并重新发送请求。

客户端**无需**维护 TRON 钱包之外的任何账户体系、登录凭据或会话 Token。所有的交互均为**无状态**的，且完全基于标准 HTTP 协议进行。


## 服务端角色 (Server Role)

服务端是要求付费才能访问其资源的提供者。

服务端的形态多种多样，包括：

- API 服务
- 数字内容提供商
- 任何可通过 HTTP 访问且寻求变现的资源

### 核心职责

- **定义支付要求**：对未附带有效支付凭证的请求响应 HTTP `402 Payment Required`，并在响应体中详细说明支付要求。
- **验证支付载荷**：调用促进者服务 (Facilitator Service) 对传入的 TIP-712 签名载荷进行验证。
- **结算交易**：验证通过后，通过促进者提交交易以完成资金结算。
- **交付资源**：支付确认无误后，向客户端返回所请求的资源。

服务端**无需**管理客户端身份或维护会话状态。验证与结算过程由促进者针对每个请求独立处理。


## 通信流程 (Communication Flow)

在 x402-tron 协议中，客户端与服务端之间的典型交互流程如下：

1.  **客户端发起请求**：向服务端发送针对付费资源的请求。
2.  **服务端要求付费**：响应 `402 Payment Required` 状态码，并在 `PAYMENT-REQUIRED` 标头中包含支付要求（Base64 编码）。
3.  **客户端提交支付**：根据要求生成 TIP-712 签名，并将签名载荷放入 `PAYMENT-SIGNATURE` 标头（Base64 编码）中重新发送请求。
4.  **服务端验证支付**：调用促进者服务对接收到的支付载荷进行验证。
5.  **服务端执行结算**：通过促进者将交易提交至 TRON 区块链完成结算。
6.  **服务端交付资源**：返回请求的资源，并在 `PAYMENT-RESPONSE` 标头中包含结算确认信息（Base64 编码，内含 TRON 交易哈希）。

## 总结 

在 x402-tron 协议体系中：

- **客户端 (Client)**：发起资源请求，并负责提供经过 TIP-712 签名的支付载荷。
- **服务端 (Server)**：执行支付策略，验证交易有效性，并在确认支付成功后交付资源。



这种交互模式完全基于原生 HTTP 协议，具备**无状态 (Stateless)** 特性，既兼容面向用户的应用程序，也能完美支持自动化/自主代理 (Autonomous Agents)。

## 下一步 

接下来，请深入探索：

- [促进者 (Facilitator)](/core-concepts/facilitator) — 了解服务端如何验证与结算支付
- [钱包 (Wallet)](/core-concepts/wallet) — 了解如何管理 TRON 钱包进行支付