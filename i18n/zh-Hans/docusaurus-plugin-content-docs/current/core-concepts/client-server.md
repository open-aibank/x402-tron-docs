# 客户端与服务器

理解这些角色对于设计、构建或集成使用 x402-tron 在 TRON 区块链上进行程序化支付的服务至关重要。

**注意**：客户端是指发起 HTTP 请求的技术组件。实际上，这通常是资源的买家。服务器是指响应请求的技术组件。实际上，这通常是资源的卖家。

## 客户端角色

客户端是发起访问付费资源请求的实体。

客户端可以包括：

- 人工操作的应用程序
- 自主代理
- 代表用户或系统行事的程序化服务

### 职责

- **发起请求**：向资源服务器发送 HTTP 请求
- **处理支付要求**：读取 402 Payment Required 响应并提取支付详情
- **管理代币授权**：确保促进者被批准代表客户端支出代币
- **准备支付负载**：使用提供的支付要求构建 TIP-712 签名的支付负载
- **携带支付重新提交请求**：使用包含签名支付负载的 PAYMENT-SIGNATURE 头重试请求

客户端除了 TRON 钱包外，无需管理账户、凭证或会话令牌。所有交互都是无状态的，通过标准 HTTP 请求进行。

## 服务器角色

服务器是强制要求付费才能访问其服务的资源提供者。

服务器可以包括：

- API 服务
- 内容提供商
- 任何需要货币化的 HTTP 可访问资源

### 职责

- **定义支付要求**：对未经身份验证的请求响应 HTTP 402 Payment Required，在响应正文中包含所有必要的支付详情
- **验证支付负载**：使用促进者服务验证传入的 TIP-712 签名支付负载
- **结算交易**：成功验证后，通过促进者提交支付进行结算
- **提供资源**：一旦确认支付，将请求的资源返回给客户端

服务器无需管理客户端身份或维护会话状态。验证和结算通过促进者按请求处理。

## 通信流程

x402-tron 协议中客户端和服务器之间的典型流程如下：

1. 客户端向服务器发起付费资源请求
2. 服务器响应 402 Payment Required，在 PAYMENT-REQUIRED 头中包含支付要求
3. 客户端根据提供的要求准备并提交支付负载，使用 TIP-712 签名
4. 服务器通过促进者服务验证支付负载
5. 服务器通过促进者结算支付，促进者将交易提交到 TRON 区块链
6. 服务器响应请求的资源，包含带有结算确认的 PAYMENT-RESPONSE 头

## 总结

在 x402-tron 协议中：

- 客户端请求资源并提供 TIP-712 签名的支付负载
- 服务器强制执行支付要求，验证交易，并在成功支付后提供资源

这种交互是无状态的、HTTP 原生的，并且与人工应用程序和自动化代理兼容。
